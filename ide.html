<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Otomatik Dil Algılama ve Çalıştırma</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.12.0/dist/tf.min.js"></script>
  <script src="https://unpkg.com/monaco-editor@latest/min/vs/loader.js"></script>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.3/full/pyodide.js"></script>
  <style>
    html, body, #editor { margin:0; padding:0; height: 70vh; width: 100%; }
    #terminal { height: 30vh; background: black; color: white; padding: 10px; overflow-y: auto; font-family: monospace;}
    button { font-size: 1.2em; margin: 10px; }
  </style>
</head>
<body>

<div id="editor"></div>
<button id="runBtn">Çalıştır</button>
<div id="terminal">🖥️ Çıktı burada...</div>

<script>
  require.config({ paths: { vs: 'https://unpkg.com/monaco-editor@latest/min/vs' }});
  let editor;

  // Pyodide yükleme
  let pyodideReady = false;
  let pyodide;

  async function loadPyodideAndPackages() {
    pyodide = await loadPyodide();
    pyodideReady = true;
    console.log("🐍 Pyodide hazır");
  }
  loadPyodideAndPackages();

  // Monaco editör oluşturma
  require(['vs/editor/editor.main'], function () {
    editor = monaco.editor.create(document.getElementById('editor'), {
      value: `print("Merhaba Dünya!")`,
      language: 'plaintext',
      theme: 'vs-dark',
      automaticLayout: true
    });

    // Kod değiştikçe otomatik dil algılama
    editor.onDidChangeModelContent(() => {
      const code = editor.getValue();
      const lang = detectLanguageSmart(code);
      monaco.editor.setModelLanguage(editor.getModel(), lang);
      console.log("🧠 Algılanan dil:", lang);
    });
  });

  // Basit ama akıllı dil tahmini
  function detectLanguageSmart(code) {
    const langPatterns = [
      { lang: 'python',     regex: /\bdef\b|\bimport\b|\bprint\(/ },
      { lang: 'javascript', regex: /\bfunction\b|\bconsole\.log\b|=>/ },
      { lang: 'cpp',        regex: /#include\s+<|int\s+main\s*\(/ },
      { lang: 'html',       regex: /<!DOCTYPE\s+html>|<html>|<body>/ },
      { lang: 'bash',       regex: /^#!\/bin\/bash|\becho\b/ },
      { lang: 'java',       regex: /\bpublic\s+class\b|\bSystem\.out\.println/ },
      { lang: 'go',         regex: /\bpackage\s+main\b|\bfunc\b/ },
      { lang: 'ruby',       regex: /\bdef\b|\bputs\b|\bend\b/ },
      { lang: 'csharp',     regex: /\busing\s+System\b|\bnamespace\b/ },
    ];

    for (let pattern of langPatterns) {
      if (pattern.regex.test(code)) {
        return pattern.lang;
      }
    }
    return 'plaintext';
  }

  // Çalıştırma butonu
  document.getElementById('runBtn').addEventListener('click', async () => {
    const code = editor.getValue();
    const lang = detectLanguageSmart(code);
    const terminal = document.getElementById('terminal');
    terminal.textContent = '';

    if (lang === 'python') {
      if (!pyodideReady) {
        terminal.textContent = '🐍 Pyodide henüz hazır değil, lütfen bekleyin...';
        return;
      }
      try {
        const output = await pyodide.runPythonAsync(code);
        terminal.textContent = output ?? '(Çıktı yok)';
      } catch(e) {
        terminal.textContent = `❌ Hata: ${e}`;
      }
    }
    else if (lang === 'javascript') {
      try {
        const result = eval(code);
        terminal.textContent = result ?? '(Çıktı yok)';
      } catch(e) {
        terminal.textContent = `❌ Hata: ${e}`;
      }
    }
    else {
      terminal.textContent = `🚫 Bu dil (${lang}) için çalıştırma desteklenmiyor.`;
    }
  });
</script>

</body>
</html>
