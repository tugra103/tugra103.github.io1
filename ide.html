<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pyodide + Monaco Minimal IDE</title>

<style>
  html, body {
    margin:0; padding:0; height:100%;
    background:#1e1e1e;
    color:#eee;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  }
  #editor {
    height: 65vh;
    width: 100%;
  }
  #terminalToggle {
    position: fixed;
    top: 10px;
    right: 150px;
    background: #007acc;
    color: white;
    border: none;
    padding: 8px 14px;
    font-weight: bold;
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
    z-index: 1100;
  }
  #runBtn {
    position: fixed;
    top: 10px;
    right: 20px;
    background: #0a84ff;
    color: white;
    border: none;
    padding: 8px 16px;
    font-weight: bold;
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
    z-index: 1100;
  }
  #output {
    position: fixed;
    bottom: 0; left: 0;
    width: 100%;
    height: 30vh;
    background: #111;
    color: #0f0;
    font-family: monospace;
    padding: 10px;
    overflow-y: auto;
    white-space: pre-wrap;
    border-top: 3px solid #007acc;
    display: none;
    box-sizing: border-box;
    z-index: 1000;
  }
</style>

<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs/loader.js"></script>
<script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>

</head>
<body>

<button id="terminalToggle">Terminal Aç/Kapa</button>
<button id="runBtn" disabled>▶️ Çalıştır</button>
<div id="editor"></div>
<div id="output">Terminal Çıktısı...</div>

<script>
  let pyodide; // Başta null ataması yok
  let editor;
  let terminalVisible = false;

  require.config({ paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs' } });
  require(['vs/editor/editor.main'], () => {
    editor = monaco.editor.create(document.getElementById('editor'), {
      value: `# Python kodunu buraya yaz\nfor i in range(5):\n    print(i)`,
      language: 'python',
      theme: 'vs-dark',
      automaticLayout: true,
      minimap: { enabled: false },
      fontSize: 16,
      mouseWheelZoom: true,
      scrollbar: { verticalScrollbarSize: 14, horizontalScrollbarSize: 14 },
      dragAndDrop: true,
    });
  });

  async function loadPyodideAndSetup() {
    const outputElem = document.getElementById('output');
    outputElem.textContent = 'Pyodide yükleniyor...';
    pyodide = await loadPyodide();

    pyodide.setStdout({
      batched: (s) => {
        if(terminalVisible) {
          outputElem.textContent += s;
          outputElem.scrollTop = outputElem.scrollHeight;
        }
      }
    });
    pyodide.setStderr({
      batched: (s) => {
        if(terminalVisible) {
          outputElem.textContent += s;
          outputElem.scrollTop = outputElem.scrollHeight;
        }
      }
    });

    outputElem.textContent += '\nPyodide yüklendi!';
    document.getElementById('runBtn').disabled = false;
  }

  async function runPythonCode() {
    if (!pyodide) {
      alert('Pyodide henüz yüklenmedi!');
      return;
    }

    const outputDiv = document.getElementById('output');
    outputDiv.textContent = ''; // Temizle
    terminalVisible = true;
    outputDiv.style.display = 'block';

    const code = editor.getValue();
    try {
      await pyodide.runPythonAsync(code);
    } catch (err) {
      outputDiv.textContent += `\nHata:\n${err}\n`;
    }
  }

  document.getElementById('runBtn').addEventListener('click', runPythonCode);

  document.getElementById('terminalToggle').addEventListener('click', () => {
    terminalVisible = !terminalVisible;
    const out = document.getElementById('output');
    out.style.display = terminalVisible ? 'block' : 'none';
  });

  loadPyodideAndSetup();
</script>

</body>
</html>
