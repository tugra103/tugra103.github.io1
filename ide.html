<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>Python IDE - Monaco + Pyodide + Autocomplete</title>
<style>
  html, body {
    margin:0; padding:0; height:100%;
    overflow: hidden;
    -webkit-user-select: text;
    -webkit-touch-callout: default;
    touch-action: manipulation;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background-color: #1e1e1e;
    color: white;
  }
  #editor {
    width: 100%;
    height: 70vh;
  }
  #output {
    height: 30vh;
    background: #111;
    color: #0f0;
    font-family: monospace;
    padding: 10px;
    overflow-y: auto;
    white-space: pre-wrap;
    border-top: 2px solid #007acc;
  }
  #runBtn {
    position: fixed;
    top: 12px;
    right: 20px;
    z-index: 1000;
    padding: 1em 1.5em;
    font-weight: bold;
    background: #007acc;
    border: none;
    color: white;
    border-radius: 6px;
    cursor: pointer;
    touch-action: manipulation;
  }
</style>

<!-- Monaco Editor loader -->
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs/loader.js"></script>
<!-- Pyodide -->
<script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
<!-- Monaco Python Language Support -->
<script src="https://cdn.jsdelivr.net/npm/@microsoft/monaco-python/dist/index.js"></script>

</head>
<body>

<div id="editor"></div>
<div id="output">Çıktı burada görünecek...</div>
<button id="runBtn">▶️ Çalıştır</button>

<script>
  let pyodide = null;
  let editor = null;

  // Monaco yükle
  require.config({ paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs' } });
  require(['vs/editor/editor.main'], function () {
    // monaco-python'u register et
    monaco.languages.python = window.monacoPython;

    editor = monaco.editor.create(document.getElementById('editor'), {
      value: `# Python kodunu buraya yaz\nfor i in range(5):\n    print(i)`,
      language: 'python',
      theme: 'vs-dark',
      automaticLayout: true,
      minimap: { enabled: false },
      fontSize: 16,
      mouseWheelZoom: true,
      accessibilitySupport: 'off',
      scrollbar: {
        verticalScrollbarSize: 14,
        horizontalScrollbarSize: 14,
        alwaysConsumeMouseWheel: true,
      },
      dragAndDrop: true,
    });

    window.monacoPython.install(monaco);
  });

  async function loadPyodideAndSetup() {
    pyodide = await loadPyodide();

    // print ve stderr çıktısını yakala, output div'ine yaz
    // Bu örnekte stdout ve stderr'i override ediyoruz
    pyodide.setStdout({
      batched: (s) => {
        appendOutput(s);
      }
    });
    pyodide.setStderr({
      batched: (s) => {
        appendOutput(s);
      }
    });
  }

  function appendOutput(text) {
    const out = document.getElementById('output');
    out.textContent += text;
    out.scrollTop = out.scrollHeight;
  }

  async function runPythonCode() {
    if (!pyodide) {
      alert('Pyodide henüz yüklenmedi, lütfen bekleyin...');
      return;
    }

    document.getElementById('output').textContent = ''; // Temizle
    const code = editor.getValue();

    try {
      await pyodide.runPythonAsync(code);
    } catch (err) {
      appendOutput(`Hata:\n${err}\n`);
    }
  }

  loadPyodideAndSetup();

  document.getElementById('runBtn').addEventListener('click', runPythonCode);
</script>

</body>
</html>

