<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Otomatik Dil AlgÄ±lama ve Ã‡alÄ±ÅŸtÄ±rma</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.12.0/dist/tf.min.js"></script>
  <script src="https://unpkg.com/monaco-editor@latest/min/vs/loader.js"></script>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.3/full/pyodide.js"></script>
  <style>
    html, body, #editor { margin:0; padding:0; height: 70vh; width: 100%; }
    #terminal { height: 30vh; background: black; color: white; padding: 10px; overflow-y: auto; font-family: monospace;}
    button { font-size: 1.2em; margin: 10px; }
  </style>
</head>
<body>

<div id="editor"></div>
<button id="runBtn">Ã‡alÄ±ÅŸtÄ±r</button>
<div id="terminal">ğŸ–¥ï¸ Ã‡Ä±ktÄ± burada...</div>

<script>
  require.config({ paths: { vs: 'https://unpkg.com/monaco-editor@latest/min/vs' }});
  let editor;

  // Pyodide yÃ¼kleme
  let pyodideReady = false;
  let pyodide;

  async function loadPyodideAndPackages() {
    pyodide = await loadPyodide();
    pyodideReady = true;
    console.log("ğŸ Pyodide hazÄ±r");
  }
  loadPyodideAndPackages();

  // Monaco editÃ¶r oluÅŸturma
  require(['vs/editor/editor.main'], function () {
    editor = monaco.editor.create(document.getElementById('editor'), {
      value: `print("Merhaba DÃ¼nya!")`,
      language: 'plaintext',
      theme: 'vs-dark',
      automaticLayout: true
    });

    // Kod deÄŸiÅŸtikÃ§e otomatik dil algÄ±lama
    editor.onDidChangeModelContent(() => {
      const code = editor.getValue();
      const lang = detectLanguageSmart(code);
      monaco.editor.setModelLanguage(editor.getModel(), lang);
      console.log("ğŸ§  AlgÄ±lanan dil:", lang);
    });
  });

  // Basit ama akÄ±llÄ± dil tahmini
  function detectLanguageSmart(code) {
    const langPatterns = [
      { lang: 'python',     regex: /\bdef\b|\bimport\b|\bprint\(/ },
      { lang: 'javascript', regex: /\bfunction\b|\bconsole\.log\b|=>/ },
      { lang: 'cpp',        regex: /#include\s+<|int\s+main\s*\(/ },
      { lang: 'html',       regex: /<!DOCTYPE\s+html>|<html>|<body>/ },
      { lang: 'bash',       regex: /^#!\/bin\/bash|\becho\b/ },
      { lang: 'java',       regex: /\bpublic\s+class\b|\bSystem\.out\.println/ },
      { lang: 'go',         regex: /\bpackage\s+main\b|\bfunc\b/ },
      { lang: 'ruby',       regex: /\bdef\b|\bputs\b|\bend\b/ },
      { lang: 'csharp',     regex: /\busing\s+System\b|\bnamespace\b/ },
    ];

    for (let pattern of langPatterns) {
      if (pattern.regex.test(code)) {
        return pattern.lang;
      }
    }
    return 'plaintext';
  }

  // Ã‡alÄ±ÅŸtÄ±rma butonu
  document.getElementById('runBtn').addEventListener('click', async () => {
    const code = editor.getValue();
    const lang = detectLanguageSmart(code);
    const terminal = document.getElementById('terminal');
    terminal.textContent = '';

    if (lang === 'python') {
      if (!pyodideReady) {
        terminal.textContent = 'ğŸ Pyodide henÃ¼z hazÄ±r deÄŸil, lÃ¼tfen bekleyin...';
        return;
      }
      try {
        const output = await pyodide.runPythonAsync(code);
        terminal.textContent = output ?? '(Ã‡Ä±ktÄ± yok)';
      } catch(e) {
        terminal.textContent = `âŒ Hata: ${e}`;
      }
    }
    else if (lang === 'javascript') {
      try {
        const result = eval(code);
        terminal.textContent = result ?? '(Ã‡Ä±ktÄ± yok)';
      } catch(e) {
        terminal.textContent = `âŒ Hata: ${e}`;
      }
    }
    else {
      terminal.textContent = `ğŸš« Bu dil (${lang}) iÃ§in Ã§alÄ±ÅŸtÄ±rma desteklenmiyor.`;
    }
  });
</script>

</body>
</html>
