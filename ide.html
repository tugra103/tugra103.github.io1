<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>Python IDE + Açılır/Kapanır Terminal</title>
<style>
  html, body {
    margin:0; padding:0; height:100%;
    background: #1e1e1e;
    color: white;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  }
  #editor {
    height: 65vh;
    width: 100%;
  }
  #terminalToggle {
    position: fixed;
    top: 12px;
    right: 140px;
    background: #007acc;
    color: white;
    border: none;
    padding: 0.7em 1.2em;
    font-weight: bold;
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
    z-index: 1100;
  }
  #runBtn {
    position: fixed;
    top: 12px;
    right: 20px;
    background: #0a84ff;
    color: white;
    border: none;
    padding: 0.7em 1.5em;
    font-weight: bold;
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
    z-index: 1100;
  }
  #output {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 30vh;
    background: #111;
    color: #0f0;
    font-family: monospace;
    padding: 10px;
    overflow-y: auto;
    white-space: pre-wrap;
    border-top: 3px solid #007acc;
    display: none;
    box-sizing: border-box;
    z-index: 1000;
  }
</style>

<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs/loader.js"></script>
<script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@microsoft/monaco-python/dist/index.js"></script>

</head>
<body>

<button id="terminalToggle">Terminal Aç/Kapa</button>
<button id="runBtn">▶️ Çalıştır</button>
<div id="editor"></div>
<div id="output">Çıktı burada görünecek...</div>

<script>
  let pyodide = null;
  let editor = null;
  let terminalVisible = false;

  require.config({ paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs' } });
  require(['vs/editor/editor.main'], function () {
    monaco.languages.python = window.monacoPython;

    editor = monaco.editor.create(document.getElementById('editor'), {
      value: `# Python kodunu buraya yaz\nfor i in range(5):\n    print(i)`,
      language: 'python',
      theme: 'vs-dark',
      automaticLayout: true,
      minimap: { enabled: false },
      fontSize: 16,
      mouseWheelZoom: true,
      accessibilitySupport: 'off',
      scrollbar: {
        verticalScrollbarSize: 14,
        horizontalScrollbarSize: 14,
        alwaysConsumeMouseWheel: true,
      },
      dragAndDrop: true,
    });

    window.monacoPython.install(monaco);
  });

  async function loadPyodideAndSetup() {
    pyodide = await loadPyodide();

    pyodide.setStdout({
      batched: (s) => {
        appendOutput(s);
      }
    });
    pyodide.setStderr({
      batched: (s) => {
        appendOutput(s);
      }
    });

    // JS console.log, console.error override (terminalde gösterim)
    (function() {
      const oldLog = console.log;
      const oldErr = console.error;
      console.log = function(...args) {
        oldLog.apply(console, args);
        appendOutput('[JS] ' + args.join(' ') + '\n');
      };
      console.error = function(...args) {
        oldErr.apply(console, args);
        appendOutput('[JS-ERR] ' + args.join(' ') + '\n');
      };
    })();
  }

  function appendOutput(text) {
    if (!terminalVisible) return; // Terminal kapalıysa ekleme yapma
    const out = document.getElementById('output');
    out.textContent += text;
    out.scrollTop = out.scrollHeight;
  }

  async function runPythonCode() {
    if (!pyodide) {
      alert('Pyodide henüz yüklenmedi, lütfen bekleyin...');
      return;
    }

    const outputDiv = document.getElementById('output');
    outputDiv.textContent = '';
    terminalVisible = true;
    outputDiv.style.display = 'block';

    const code = editor.getValue();
    try {
      await pyodide.runPythonAsync(code);
    } catch (err) {
      appendOutput(`Hata:\n${err}\n`);
    }
  }

  document.getElementById('runBtn').addEventListener('click', runPythonCode);

  document.getElementById('terminalToggle').addEventListener('click', () => {
    terminalVisible = !terminalVisible;
    document.getElementById('output').style.display = terminalVisible ? 'block' : 'none';
  });

  loadPyodideAndSetup();
</script>

</body>
</html>
